# GitHub Actions Workflows

This directory contains automated CI/CD workflows for the LightJockey project.

‚ö†Ô∏è **Important Note on Automation**: The workflow creates issues/PRs automatically but **GitHub Copilot Workspace must be manually activated** to implement tasks. See [AUTO_TASK_TROUBLESHOOTING.md](../docs/AUTO_TASK_TROUBLESHOOTING.md) for details.

## Workflow Structure

### Auto-Task Workflows

#### Flow Auto-Task 01: Start Next Task
**File**: `flow-autotask_01-start.yml`

**Purpose**: Automatically creates issues and PRs for uncompleted tasks.

**Triggers**:
- On push to `main` branch
- Manual workflow dispatch

**What it does**:
- Parses development plan for next uncompleted task
- Creates feature branch
- Creates GitHub issue with task details
- Creates draft pull request
- Links issue to PR

**Configuration**: Requires `AUTOMATION_ENABLED` repository variable set to `true`.

#### Flow Auto-Task 01b: Notify for Copilot Action
**File**: `flow-autotask_01b-notify-copilot.yml`

**Purpose**: Adds instructions to auto-generated PRs for Copilot activation.

**Triggers**:
- When PR is opened with `autogenerated` label

**What it does**:
- Comments on PR with activation instructions
- Updates PR description
- Assigns PR to repository owner

#### Flow Auto-Task 02: Test & Merge
**File**: `flow-autotask_02-merge.yml`

**Purpose**: Automatically merges PRs after successful CI.

**Triggers**:
- After CI workflow completes successfully

**What it does**:
- Checks if automation is enabled
- Converts draft PR to ready for review
- Adds automerge label
- Merges PR if tests passed

### Continuous Integration

### 1. Unit Tests (Automatic)
**File**: `Unit-Tests.yml`  
**Status**: [![Unit Tests](https://github.com/MrLongNight/LightJockey/actions/workflows/Unit-Tests.yml/badge.svg)](https://github.com/MrLongNight/LightJockey/actions/workflows/Unit-Tests.yml)

**Purpose**: Run unit tests automatically and upload coverage to Codecov.

**Triggers**:
- ‚úÖ Automatic on push to `main` or `develop`
- ‚úÖ Automatic on pull requests to `main` or `develop`

**What it does**:
- Builds the solution
- Runs all unit tests (179+ tests)
- Collects code coverage
- Uploads coverage to Codecov

### 2. Build (Automatic)
**File**: `build.yml`  
**Status**: [![Build](https://github.com/MrLongNight/LightJockey/actions/workflows/build.yml/badge.svg)](https://github.com/MrLongNight/LightJockey/actions/workflows/build.yml)

**Purpose**: Verify that the solution builds successfully.

**Triggers**:
- ‚úÖ Automatic on push to `main` or `develop`
- ‚úÖ Automatic on pull requests to `main` or `develop`

**What it does**:
- Restores NuGet packages
- Builds the solution in Release configuration
- Uploads build artifacts (1-day retention)

### 3. Release MSI Package (Manual)
**File**: `release-msi.yml`  
**Status**: [![Release MSI](https://github.com/MrLongNight/LightJockey/actions/workflows/release-msi.yml/badge.svg)](https://github.com/MrLongNight/LightJockey/actions/workflows/release-msi.yml)

**Purpose**: Create MSI installer package for distribution.

**Triggers**:
- üîß Manual workflow dispatch (with optional version input)
- ‚úÖ Automatic on version tags (e.g., `v1.0.0`)

**What it does**:
- Builds the solution
- Runs tests to ensure quality
- Publishes the application
- Creates MSI installer using WiX Toolset v4
- Uploads MSI artifact (90-day retention)
- Creates GitHub Release (when triggered by tag)

## Usage

### Running Tests (Automatic)
Tests run automatically on every push and PR. No action needed.

### Building (Automatic)
Builds run automatically on every push and PR. No action needed.

### Creating a Release Package (Manual)

**Option 1: Manual trigger with custom version**
1. Go to **Actions** ‚Üí **Release MSI Package**
2. Click **Run workflow**
3. Enter version number (e.g., `1.0.0`) or leave default
4. Click **Run workflow**

**Option 2: Tag-based release**
```bash
git tag v1.0.0
git push origin v1.0.0
```
This will:
- Trigger MSI package creation
- Create a GitHub Release
- Attach the MSI installer to the release

## Workflow Requirements

### Secrets
- `CODECOV_TOKEN` - For code coverage uploads (optional but recommended)
- `GITHUB_TOKEN` - Automatically provided by GitHub Actions

### CI Environment
- Windows runner (windows-latest)
- .NET 9.0 SDK
- WiX Toolset v4 (installed automatically)

## Local Development

```powershell
# Build
dotnet build --configuration Release

# Test
dotnet test --configuration Release

# Publish (for MSI packaging)
dotnet publish src/LightJockey/LightJockey.csproj `
  --configuration Release `
  --runtime win-x64 `
  --self-contained false `
  --output publish

# Install WiX (one-time)
dotnet tool install --global wix

# Build MSI (requires WiX source file)
# See docs/tasks/Task10_CICD_MSI.md for details
```

## Troubleshooting

### Build Failures
- Verify .NET 9.0 SDK is installed
- Check NuGet package availability
- Review build logs in Actions tab

### Test Failures
- Tests require Windows environment
- Check test logs for specific failures

### MSI Package Failures
- Ensure WiX Toolset installation succeeded
- Verify publish directory contains all required files
- Check WiX source file (.wxs) syntax

## Documentation

For detailed information:
- [Task 10: CI/CD & MSI Packaging](../../docs/tasks/Task10_CICD_MSI.md)

## Summary

| Workflow | Trigger | Purpose |
|----------|---------|---------|
| Unit Tests | Automatic (push/PR) | Run tests & coverage |
| Build | Automatic (push/PR) | Verify build success |
| Release MSI | Manual / Tags | Create installer package |

This structure provides:
- ‚úÖ Automatic quality checks on every change
- ‚úÖ Manual control over release packaging
- ‚úÖ Clear separation of concerns
